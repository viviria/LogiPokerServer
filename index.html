<!DOCTYPE html> 
<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
</head>
<body>
    <h1 style="padding-top: 3%; padding-left: 5%;">LogiPoker</h1>

    <div id="room">
        <form style="padding-top: 2%; padding-left: 5%;">
            <div>
                <input id="room1" type='button' class="ui blue button" style="margin-top: 1%;" value="ルーム1">
                <label id="room1-num" style="color:red;">0人</label>
            </div>
            <div>
                <input id="room2" type='button' class="ui blue button" style="margin-top: 1%;" value="ルーム2">
                <label id="room2-num" style="color:red;">0人</label>
            </div>
            <div>
                <input id="room3" type='button' class="ui blue button" style="margin-top: 1%;" value="ルーム3">
                <label id="room3-num" style="color:red;">0人</label>
            </div>
            <div>
                <input id="room4" type='button' class="ui blue button" style="margin-top: 1%;" value="ルーム4">
                <label id="room4-num" style="color:red;">0人</label>
            </div>
            <div>
                <input id="room5" type='button' class="ui blue button" style="margin-top: 1%;" value="ルーム5">
                <label id="room5-num" style="color:red;">0人</label>
            </div>
        </form>
    </div>

    <div id="login" style="display: none;">
        <form id="form" class="ui form" action="" style="padding-top: 1%; padding-left: 5%;">
            <div class="field">
                <label>Player Name</label>
                <input id="input" type="text" autocomplete="off" style="width: 40%;"/>
                <button class='ui primary button'>Login</button>
            </div>
        </form>
    </div>

    <div id="game">
        <a href="/game">ゲーム</a>
    </div>
</body>
<script src="https://cdn.socket.io/3.1.3/socket.io.min.js"></script>
<script src="public/Const.js"></script>
<script src="public/CreateUser.js"></script>
<script type="text/javascript">
$(function() {
    const socket = io()
    const UserID = CreateUserID()

    // 接続開始処理
    socket.emit('Enter', UserID)

    // 各ルームの人数を取得
    socket.emit('RequestRoomUserNum')
    socket.on('ResponseRoomUserNum', (RoomUserNumMap) => {
        for (let RoomID in RoomUserNumMap) {
            const NumLabel = document.getElementById(RoomID + '-num')
            if (NumLabel) {
                NumLabel.innerHTML = RoomUserNumMap[RoomID] + '人'
            }
        }
    })

    // ルームボタンのイベントを登録
    const RoomNum = GetRoomNum()
    let SelectRoomID = ""
    for (let i = 0; i < RoomNum; i++) {
        const RoomButton = document.getElementById('room' + (i + 1))
        RoomButton.onclick = (e) => {
            SelectRoomID = e.target.id
            const Room = document.getElementById('room')
            const login = document.getElementById('login')
            Room.style.display = 'none'
            login.style.display = 'block'
        }
    }

    // ログイン
    const form = document.getElementById('form')
    const input = document.getElementById('input')
    form.addEventListener('submit', (e) => {
        e.preventDefault()
        if (input.value) {
            localStorage.setItem('LogiPokerUserID', UserID)
            socket.emit('EnterUserIntoRoom', UserID, SelectRoomID, input.value)
            input.value = ''
        }
    })
})
</script>
